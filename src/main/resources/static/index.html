<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SyPastebin</title>
    <link rel="stylesheet" href="css/indexCss.css">
    <script src="js/indexScript.js"></script>
    <script src="script/jquery.js"></script>
    <script>
        <!-- get data from backend -->
        $(document).ready(function () {
            $("#generate_btn").click(function () {
                var paste_code = $("#paste_code").val();

                // 处理粘贴输入框为空的情况，发起提示。
                // var str = paste_code.replace(/(^\s*)|(\s*$)/g, '');//把val首尾的空格去掉。
                var str = paste_code;
                if (str === '' || str === undefined) {//输入框中输入空格也为空
                    alert("粘贴内容不能为空");
                    return;
                }

                var saveTime = $("#select_save_time option:selected").val();
                $.ajax({
                    url: "/save",
                    type: "post",
                    dataType: "html",
                    data: {
                        "pasteCode": paste_code,
                        "saveTime": saveTime
                    },
                    success: function (msg) {
                        $("#res").html(msg);
                    }
                });
            });
        });

        //turn to show page
        function visit_url() {
            var url = $("#res").html();
            if (url != null) {
                window.open(url);
            }
        }

        function click_copy_url() {
            var url = $("#res").html();
            var oInput = document.createElement('input');
            oInput.value = url;
            document.body.appendChild(oInput);
            oInput.select(); // 选择对象
            document.execCommand("Copy"); // 执行浏览器复制命令
            oInput.className = 'oInput';
            oInput.style.display = 'none';
            alert("复制成功");

        }
    </script>
</head>

<body>
<div style="text-align: center">
    <h2>Welcome to SyPastebin</h2>
</div>

<!--点击Generate，进行生成url，而本页面不动。通过ajax返回url并显示出来-->
<!--由js的ajax实现提交数据到后台-->

<div style="text-align: center">

    <label for="paste_code">粘贴面板</label><input id="paste_code" name="paste_code" type="text">

    <!--下拉选择保存时间-->
    <label for="select_save_time">选择保存时间</label><select id="select_save_time" name="select_save_time">
    <option id="time1" value="1" selected>不过期</option>
    <option id="time2" value="2">一天</option>
    <option id="time3" value="3">两天</option>
    <option id="time4" value="4">一周</option>
    <option id="time5" value="5">一个月</option>
</select>

    <button id="generate_btn" name="generate">生成</button>

</div>

<!--ajax取得生成的url，并显示在下面，作为一个link给用户访问-->

<!--todo这部分可先隐藏，生成url再显示-->
<div style="text-align: center">
    生成的url：
    <div id="res"></div>
    <button id="visit_btn" onclick="visit_url()">访问</button>
    <button id="copy_btn" onclick="click_copy_url()">复制</button>
</div>

</body>

</html>